@using AsloobBedaa.Models.Letter
@model LetterTemplate

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@Model.Title - Preview</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Times New Roman', Times, serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 210mm;
            margin: 0 auto;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        /* Letter Page - Exact A4 dimensions */
        .letter-page {
            width: 210mm;
            min-height: 297mm;
            padding: 30px 40px 60px 40px;
            background: white;
            position: relative;
        }

        /* Top Header Section - Centered Logo and Date */
        .top-header {
            text-align: end;
            margin-bottom: 20px;
        }

        .logo-section {
            display: inline-block;
        }

        .company-logo {
            max-width: 120px;
            height: auto;
            margin-bottom: 10px;
        }

        .date-section {
            font-size: 9pt;
            color: #000;
            margin-top: 10px;
            padding-bottom: 10px;
            border-bottom: 2px solid #ff8c00;
        }

        /* Title */
        .letter-title {
            text-align: center;
            font-size: 14pt;
            font-weight: bold;
            text-decoration: underline;
            margin: 30px 0 25px 0;
            color: #000;
        }

        /* Sections */
        .section {
            margin-bottom: 15px;
        }

        .section-header {
            font-size: 10pt;
            font-weight: bold;
            text-decoration: underline;
            margin-bottom: 8px;
            color: #000;
        }

        .section-content {
            font-size: 10pt;
            line-height: 1.6;
            text-align: justify;
            color: #000;
            margin-bottom: 5px;
        }

        .section-content p {
            margin-bottom: 3px;
        }

        /* Footer - Updated design */
        .footer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: #f0f0eb;
            padding: 10px 40px;
            font-size: 7pt;
            color: #666;
        }

        .footer-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
        }

        .page-number {
            font-size: 9pt;
            color: #000;
            margin-bottom: 5px;
        }

        .footer-disclaimer {
            text-align: center;
            line-height: 1.4;
        }

        /* Action Buttons */
        .action-bar {
            background: #fff;
            padding: 20px;
            text-align: center;
            border-top: 1px solid #ddd;
        }

        .btn {
            padding: 12px 30px;
            margin: 0 10px;
            border: none;
            border-radius: 5px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s;
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        /* Loading */
        .loading {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 9999;
            justify-content: center;
            align-items: center;
        }

        .loading.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #007bff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @@keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loader-text {
            color: white;
            margin-top: 20px;
            font-size: 16px;
        }

        /* Print Styles */
        @@media print {
            body {
                background: white;
                padding: 0;
            }

            .container {
                box-shadow: none;
            }

            .action-bar {
                display: none !important;
            }

            .letter-page {
                padding: 20mm 15mm 20mm 15mm;
            }

            .footer {
                position: fixed;
                bottom: 0;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading" id="loadingOverlay">
        <div style="text-align: center;">
            <div class="spinner"></div>
            <div class="loader-text">Generating PDF...</div>
        </div>
    </div>

    <div class="container">
        <!-- Letter Content -->
        <div class="letter-page">
            <!-- Top Header - Centered Logo and Date -->
            <div class="top-header">
                <div class="logo-section">
                    <img src="~/images/header_logo.jpg" 
                         alt="Company Logo" 
                         class="company-logo" />
                </div>
                <div class="date-section">
                    Date: @DateTime.Now.ToString("dd/MM/yyyy")
                </div>
            </div>

            <!-- Title -->
            <h1 class="letter-title">@Model.Title</h1>

            <!-- Sections -->
            @foreach (var sectiond in Model.Sections.OrderBy(x => x.SerialNo))
            {
                <div class="section">
                    <div class="section-header">
                        @sectiond.SerialNo. @sectiond.Header
                    </div>
                    <div class="section-content">
                        @if (!string.IsNullOrEmpty(sectiond.Description))
                        {
                            @foreach (var line in sectiond.Description.Split('\n'))
                            {
                                if (!string.IsNullOrWhiteSpace(line))
                                {
                                    <p>@line.Trim()</p>
                                }
                            }
                        }
                    </div>
                </div>
            }

            <!-- Footer -->
            <div class="footer">
                <div class="footer-content">
                    <div class="page-number">Page 1</div>
                    <div class="footer-disclaimer">
                        DISCLAIMER: This statement is for information purposes only. Payment amounts, services, and dates may change based on project needs and contractor agreements. 
                        Please verify all details with Accounts Department (Asloob Bedaa Contracting Co.) For any other inquiries or discrepancies, 
                        please contact our Accounts Department at +96654181845, +96656024445 or email us at accounts@("@")asloob.com
                    </div>
                </div>
            </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-bar">
            <a href="@Url.Action("Index")" class="btn btn-secondary">
                ← Back to List
            </a>
            
            <button onclick="window.print()" class="btn btn-primary">
                🖨️ Browser Print
            </button>
            
            <a href="@Url.Action("PrintPDF", new { id = Model.Id })" 
               class="btn btn-success"
               onclick="showLoading(); return true;">
                📥 Download PDF
            </a>
        </div>
    </div>

    <script>
        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('active');
            setTimeout(function() {
                document.getElementById('loadingOverlay').classList.remove('active');
            }, 2000);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'p') {
                e.preventDefault();
                window.print();
            }
            if (e.ctrlKey && e.key === 'd') {
                e.preventDefault();
                document.querySelector('a[href*="PrintPDF"]').click();
            }
        });
    </script>
</body>
</html>
